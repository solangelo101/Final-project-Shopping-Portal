var PixelRenderer={GOOGLE_PIXEL_SRC_RETARGET_ONLY_SRC:["https://www.google.com/pagead/1p-user-list/{id}/?num=1&guid=ON&url=","https://googleads.g.doubleclick.net/pagead/viewthroughconversion/{id}/?num=1&guid=ON&url="],GOOGLE_PIXEL_SRC_CONVERSION_TRACK_SRC:["https://www.google.com/ads/conversion/{id}/?num=1&guid=ON&url=","https://googleads.g.doubleclick.net/pagead/viewthroughconversion/{id}/?num=1&guid=ON&url="],GOOGLE_LANDING_PAGE_PARAM:"url",GOOGLE_GLOBAL_SITE_ID:"1037625867",GOOGLE_AD_WORD_PARAMS:{event:"",ecomm_prodid:"",ecomm_pagetype:"",ecomm_totalvalue:""},FACEBOOK_BASE_PIXEL_SRC:"https://www.facebook.com/tr/?id={id}&ev=PageView&dl=",FACEBOOK_EVENT_PIXEL_SRC:"https://www.facebook.com/tr/?id={id}&ev={event}&dl=",FACEBOOK_LANDING_PAGE_PARAM:"dl",FACEBOOK_DATA_GROUPING_PARAM:"cd",CRITEO_PRODUCT_EVENT_STRING:"vb::vc",CRITEO_PRODUCT_PARAM:"p",CRITEO_ENCODED_BRACKET_OPEN:"%5B",CRITEO_ENCODED_BRACKET_CLOSED:"%5D",CRITEO_PIXEL_SRC:"https://sslwidget.criteo.com/event?a={id}&adce=1&tld=",BING_BASE_PIXEL_SRC:"https://bat.bing.com/action/0?ti={ti}&Ver=2&",EXPECTED_NAME_FOR_BING_CONVERSION_COOKIE:"_msclkid",BING_CLICK_ID_PARAM_NAME:"msclkid",PAGE_TYPE_THANK_YOU:"thankyou",timeStamp:"0",init:function(){window.addEventListener("message",function(e){e.origin===window.location.protocol+"//"+document.domain&&PixelRenderer.createPixels(e.data)},!1),this.messageParent()},messageParent:function(){window.parent.postMessage(JSON.stringify({name:"pixels",msg:"loaded"}),"*")},createPixels:function(e){var i,t=JSON.parse(e),o=t.pixels;for(this.origin=t.origin,this.timeStamp=t.timeStamp,i=0;i<o.length;i++)this.pixelFactory(o[i])},appendPixel:function(e){var i=document.createElement("img");i.src=e+"&ts="+this.timeStamp,document.body.appendChild(i)},pixelFactory:function(e){var i=e.pixel_type,t=e,o=encodeURIComponent(this.origin);switch(i){case"google":t[this.GOOGLE_LANDING_PAGE_PARAM]=o,this.buildGooglePixels(t);break;case"facebook-pageview":t[this.FACEBOOK_LANDING_PAGE_PARAM]=o,this.buildFaceBookBasePixel(t);break;case"facebook-event":t[this.FACEBOOK_LANDING_PAGE_PARAM]=o,this.buildFaceBookEventPixel(t);break;case"criteo":this.buildCriteoPixels(t);break;case"bing":this.buildBingPixels(t)}},serialize:function(e,i,t,o){var n,r,s=[];for(n in e)e.hasOwnProperty(n)&&(r=n,o&&(r=o+"["+n+"]"),s.push(r+"="+e[n]));return t?encodeURIComponent(s.join(i)):s.join(i)},buildGooglePixels:function(e){var i,t=this.getClickIdFromUrlQueryString("gclid"),o=e.google_remarketing_only?this.GOOGLE_PIXEL_SRC_RETARGET_ONLY_SRC:this.GOOGLE_PIXEL_SRC_CONVERSION_TRACK_SRC,n=this.PAGE_TYPE_THANK_YOU===e.google_custom_params.ecomm_pagetype;if(""!==t&&this.createGoogleClickIdCookieForTYPageConversionTag(t),"gtag.config"===e.google_custom_params.event)this.doGoogleConfigInit(e,e.google_conversion_id),n||this.doGoogleConfigInit(e,this.GOOGLE_GLOBAL_SITE_ID);else for(i=0;i<o.length;i++)this.buildGoogleSiteRetargeting(e,o,i),n||this.buildGoogleAdWordPixels(e.google_custom_params,o,e.url,i)},buildGoogleAdWordPixels:function(e,i,t,o){var n=i[o].replace("{id}","1037625867");n+=t,n+=this.buildGoogleAdWordQueryString(e),this.appendPixel(n)},buildGoogleAdWordQueryString:function(e){var i=this.GOOGLE_AD_WORD_PARAMS;return i.event=e.event,i.ecomm_prodid=e.ecomm_prodid,i.ecomm_pagetype=e.ecomm_pagetype,i.ecomm_totalvalue=e.ecomm_totalvalue,this.buildGoogleCustomDataParams(i)},buildGoogleSiteRetargeting:function(e,i,t){var o=i[t].replace("{id}",e.google_conversion_id);o+=e.url,o+=this.buildGoogleCustomDataParams(e.google_custom_params),this.appendPixel(o)},doGoogleConfigInit:function(e,i){var t=PixelRenderer.GOOGLE_PIXEL_SRC_RETARGET_ONLY_SRC[1].replace("{id}",i);t+=e.url,t+="&data=event%3Dgtag.config",this.appendPixel(t)},getClickIdFromUrlQueryString:function(e){var i=window.location.search;return-1===i.indexOf(e)?"":this.parseQueryStringForClickId(i.substring(1),e)},parseQueryStringForClickId:function(e,i){for(var t,o=e.split("&"),n=0;n<o.length;n++)if((t=o[n].split("="))[0]===i)return this.persistAndReturnClickId(i,t[1])},persistAndReturnClickId:function(e,i){var t=this.createClickIdForNetwork(e,i);return this.persistClickData(e,t),t},createGoogleClickIdCookieForTYPageConversionTag:function(e){this.persistClickData("_gcl_aw",e)},persistClickData:function(e,i){var t=new Date;t.setTime(t.getTime()+5184e6);var o="; expires="+t.toGMTString();document.cookie=e+"="+i+o+"; path=/"},createClickIdForNetwork:function(e,i){switch(e){case"gclid":return"GCL."+this.timeStamp+"."+i;case this.BING_CLICK_ID_PARAM_NAME:return i}},buildGoogleCustomDataParams:function(e){return"&data="+this.serialize(e,";",!0)},buildFaceBookBasePixel:function(e){var i=this.FACEBOOK_BASE_PIXEL_SRC.replace("{id}",e.init);i+=e.dl,this.appendPixel(i)},buildFaceBookEventPixel:function(e){var i=this.FACEBOOK_EVENT_PIXEL_SRC.replace("{id}",e.init);i=i.replace("{event}",e.eventType),i+=e.dl,i+="&",i+=this.serialize(e.cd,"&",!1,this.FACEBOOK_DATA_GROUPING_PARAM),this.appendPixel(i)},buildCriteoPixels:function(e){var i,t,o=this.CRITEO_PIXEL_SRC.replace("{id}",e.site_id),n=e.events;for(o+=e.tld,i=0;i<n.length;i++)t=n[i],o+="&p"+i+"=",-1===this.CRITEO_PRODUCT_EVENT_STRING.indexOf(t.e)?o+=this.serialize(t,"&",!0):o+=this.buildCriteoEncodedProductIdsString(t);this.appendPixel(o)},buildCriteoEncodedProductIdsString:function(e){var i,t=[],o=e,n=o[this.CRITEO_PRODUCT_PARAM];for(i=0;i<n.length;i++)t.push(this.serialize(n[i],"&",!0));return o[this.CRITEO_PRODUCT_PARAM]=this.CRITEO_ENCODED_BRACKET_OPEN+encodeURIComponent(t.join(","))+this.CRITEO_ENCODED_BRACKET_CLOSED,this.serialize(o,"&",!0)},buildBingPixels:function(e){if("12345"!==e.bing_tag_id){var i=this.getClickIdFromUrlQueryString(this.BING_CLICK_ID_PARAM_NAME),t=this.BING_BASE_PIXEL_SRC;this.prepareBingPageParams(e.bing_custom_params),""===i?i=this.getCookieValue(this.EXPECTED_NAME_FOR_BING_CONVERSION_COOKIE):this.createBingClickIdCookieForTYPageConversionTag(i),i&&"undefined"!==i&&(e.bing_custom_params.msclkid=i+"-0"),t=t.replace("{ti}",e.bing_tag_id),t+=this.serialize(e.bing_custom_params,"&"),this.appendPixel(t)}},prepareBingPageParams:function(e){var i;e.mid=this.bing.createUetSessionId(),e.rn=Math.floor(1e6*Math.random()),"custom"===e.evt?(e.en="Y",e.type=void 0):(e.p=this.origin?encodeURIComponent(this.origin):void 0,e.r=(i=window.parent)&&i.document&&i.document.referrer?encodeURIComponent(i.document.referrer):void 0,e.pi=this.bing.getDigitalSignature()),this.cleanUp(e)},cleanUp:function(e){for(var i in e)void 0===e[i]&&delete e[i]},createBingClickIdCookieForTYPageConversionTag:function(e){this.persistClickData(this.EXPECTED_NAME_FOR_BING_CONVERSION_COOKIE,e)},bing:{createUetSessionId:function(){var e;return void 0===this.bingSessionId?(e=this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4(),this.bingSessionId=e):e=this.bingSessionId,e},s4:function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},getDigitalSignature:function(){for(var e,i,t,o=[],n=0;n<window.navigator.plugins.length;n++)o.push({name:window.navigator.plugins[n].name});for(e=o.sort(function(e,i){return e.name>i.name?1:e.name<i.name?-1:0}),i="",t=0;t<e.length;t++)i+=e[t].name;return this.hashCode(i)},hashCode:function(e){var i,t=0;if(0===e.length)return t;for(i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t&=t;return t}},getCookieValue:function(e){var i=document.cookie,t=e+"=",o=i.indexOf("; "+t);if(-1==o){if(0!=(o=i.indexOf(t)))return null}else o+=2;var n=document.cookie.indexOf(";",o);-1==n&&(n=i.length);try{return decodeURI(i.substring(o+t.length,n))}catch(e){return""}}};PixelRenderer.init();